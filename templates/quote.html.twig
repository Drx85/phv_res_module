{% extends 'base.html.twig' %}

{% block title %}
	Module de réservation pour VTC - Devis
{% endblock %}

{% block body %}
	<h1>Devis</h1>
	<h3>Origine</h3>
	<p>{{ quote.originAddress }}</p>
	<h3>Destination</h3>
	<p>{{ quote.destinationAddress }}</p>
	<h3>Devis</h3>
	<ul>
		<li>Distance : {{ quote.travelDistanceInKms }} km(s)</li>
		<li>Temps de trajet estimé : {{ quote.formattedTravelTime }}</li>
		<li><strong>Prix</strong> : <span id="price">{{ quote.price }}</span> euros net TTC</li>
	</ul>
	<div id="paypal-button-container"></div>
{% endblock %}

{% block javascripts %}
	<script src="https://www.paypal.com/sdk/js?client-id={{ paypal_id }}&currency=EUR" data-sdk-integration-source="button-factory"></script>
	<script>
		window.onload = () => {
			paypal.Buttons({
				// Sets up the transaction when a payment button is clicked
				createOrder: function () {
					return fetch('/quote/payment', {
						method: 'post',
						headers: {
							'content-type': 'application/json'
						}
					}).then(function(res) {
						return res.json();
					}).then(function(data) {
						return data.res.result.id; // Use the key sent by your server's response, ex. 'id' or 'token'
					});
				},
				// Finalize the transaction after payer approval
				onApprove: function (data, actions) {
					return actions.order.capture().then(function (orderData) {
						// Successful capture! For dev/demo purposes:
						console.log('Capture result', orderData, JSON.stringify(orderData, null, 2));
						var transaction = orderData.purchase_units[0].payments.captures[0];
						alert('Transaction ' + transaction.status + ': ' + transaction.id + '\n\nSee console for all available details');
						
						// When ready to go live, remove the alert and show a success message within this page. For example:
						// var element = document.getElementById('paypal-button-container');
						// element.innerHTML = '';
						// element.innerHTML = '<h3>Thank you for your payment!</h3>';
						// Or go to another URL:  actions.redirect('thank_you.html');
					});
				}
			}).render('#paypal-button-container');
		}
	</script>
{% endblock %}